!function(wp){var __=wp.i18n.__,useSelect=wp.data.useSelect,useDispatch=wp.data.useDispatch,el=wp.element.createElement,Fragment=wp.element.Fragment,useState=wp.element.useState,Textarea=wp.components.TextareaControl,Toggle=wp.components.ToggleControl,Button=wp.components.Button,Notice=wp.components.Notice,PasteJSONForm=function(){const[text,setText]=useState(""),[pastePostName,setPastePostName]=useState(!0),[pasteMetaValues,setPasteMetaValues]=useState(!0),[noticeText,setNoticeText]=useState(""),[noticeStatus,setNoticeStatus]=useState(""),[parsedPostData,setParsedPostData]=useState(null),escapeContent=function(content){let div=document.createElement("div");return div.innerHTML=content.replace(/</g,"&lt;").replace(/>/g,"&gt;"),div.textContent||div.innerText},getEditorSettings=useSelect(select=>()=>select(wp.editor.store).getEditorSettings(),[]),getPostID=useSelect(select=>()=>select(wp.editor.store).getCurrentPostId(),[]),getPostType=useSelect(select=>()=>select(wp.editor.store).getCurrentPostType(),[]),getPostAttribute=useSelect(select=>attribute=>select(wp.editor.store).getEditedPostAttribute(attribute),[]),jsonPostData=function(){let categories=null;if(0<post_terms.category.length){categories=[];const cat_ids=getPostAttribute("categories");post_terms.category.forEach((function(category){cat_ids.includes(category.id)&&categories.push({id:category.id,name:category.name,slug:category.slug})}))}let tags=null;if(0<post_terms.post_tag.length){tags=[];const tag_ids=getPostAttribute("tags");post_terms.post_tag.forEach((function(tag){tag_ids.includes(tag.id)&&tags.push({id:tag.id,name:tag.name,slug:tag.slug})}))}const meta=getPostAttribute("meta"),settings=getEditorSettings();if(null!=settings.enableCustomFields&&settings.enableCustomFields)for(let key in classic_meta)"object"==typeof meta[key]?meta[key]=classic_meta[key]:void 0!==meta[key]&&(meta[key]=classic_meta[key][0]);const postData={post_type:getPostType(),post_title:getPostAttribute("title"),post_name:getPostAttribute("slug"),menu_order:getPostAttribute("menu_order"),post_template:getPostAttribute("template"),post_content:getPostAttribute("content"),post_excerpt:getPostAttribute("excerpt"),post_category:categories,post_tag:tags,post_meta:meta,classic_meta:classic_meta};return JSON.stringify(postData)},onCopySuccess=function(){setNoticeStatus("success"),setNoticeText(__("The content has been copied to the clipboard.","paste-json-text-js"))},confirmPostData=function(newContent){if(newContent)try{const postData=JSON.parse(newContent);setParsedPostData(postData),isValidPostData(postData)?(setNoticeStatus("info"),setNoticeText(__("JSON text is valid post data.","paste-json-text-js"))):(setNoticeStatus("warning"),setNoticeText(__("JSON text is not post data.","paste-json-text-js")))}catch(error){setNoticeStatus("error"),setNoticeText(__("Not a valid JSON text.","paste-json-text-js"))}else setNoticeStatus(""),setNoticeText("")},isValidPostData=function(postData){return null!==postData&&"string"==typeof postData.post_type&&"string"==typeof postData.post_title&&"string"==typeof postData.post_name&&"string"==typeof postData.post_content},pastePostData=async function(){if(wp.data.dispatch("core/editor").editPost({title:parsedPostData.post_title,template:parsedPostData.post_template,menu_order:parsedPostData.menu_order,content:parsedPostData.post_content,excerpt:parsedPostData.post_excerpt}),0<post_terms.category.length){let categories=[];parsedPostData.post_category.forEach((function(category){for(let i=0;i<post_terms.category.length;i++)if(category.name===post_terms.category[i].name){categories.push(post_terms.category[i].id);break}})),wp.data.dispatch("core/editor").editPost({categories:categories})}if(0<post_terms.post_tag.length){let tags=[];parsedPostData.post_tag.forEach((function(tag){for(let i=0;i<post_terms.post_tag.length;i++)if(tag.name===post_terms.post_tag[i].name){tags.push(post_terms.post_tag[i].id);break}})),wp.data.dispatch("core/editor").editPost({tags:tags})}if(pastePostName&&wp.data.dispatch("core/editor").editPost({name:parsedPostData.post_name}),pasteMetaValues){wp.data.dispatch("core/editor").editPost({meta:parsedPostData.post_meta});const settings=getEditorSettings();if(null!=settings.enableCustomFields&&settings.enableCustomFields){const metaKeySelect=document.getElementById("metakeyselect");metaKeySelect.classList.add("hide-if-js");const metaKeyInput=document.getElementById("metakeyinput");metaKeyInput.classList.remove("hide-if-js");const metaValue=document.getElementById("metavalue"),newMetaSubmit=document.getElementById("newmeta-submit");for(let key in parsedPostData.classic_meta)for(let i=0;i<parsedPostData.classic_meta[key].length;i++)metaKeyInput.value=key,metaValue.innerHTML=escapeContent(parsedPostData.classic_meta[key][i]),newMetaSubmit.click();metaKeyInput.classList.add("hide-if-js"),metaKeySelect.classList.remove("hide-if-js")}}setNoticeStatus("success"),setNoticeText(__("Pasted in the post.","paste-json-text-js"))};let classic_meta=null;const formData=new FormData;formData.append("post_id",getPostID()),formData.append("_ajax_nonce",paste_json_text_nonce),fetch(ajaxurl+"?action=get_postmeta_classic",{method:"POST",cache:"no-cache",credentials:"same-origin",referrerPolicy:"origin",body:formData}).then(response=>response.json()).then(data=>{classic_meta=data.data.meta}),wp.apiFetch({path:"/wp/v2/categories"}).then(result=>{post_terms.post_category=[],result.forEach((function(category){post_terms.post_category.push({id:category.id,name:category.name,slug:category.slug})}))}),wp.apiFetch({path:"/wp/v2/tags"}).then(result=>{post_terms.post_tag=[],result.forEach((function(tag){post_terms.post_tag.push({id:tag.id,name:tag.name,slug:tag.slug})}))});const copyRef=wp.compose.useCopyToClipboard(jsonPostData,onCopySuccess);return el(Fragment,{},noticeText?el(Notice,{status:noticeStatus,onDismiss:function(){setNoticeStatus(""),setNoticeText("")}},noticeText):"",el("div",{className:"components-panel__body is-opened"},el("div",{className:"components-panel__row"},el(Button,{label:"copy",variant:"secondary",ref:copyRef},__("Copy content","paste-json-text-js"))),el("hr"),el("div",{className:"components-base-control"},el(Textarea,{label:__("JSON text","paste-json-text-js"),rows:10,value:text,onChange:function(newContent){setText(newContent),confirmPostData(newContent)}})),isValidPostData(parsedPostData)?el("div",{className:"components-base-control"},el("p",{},__("Select content to paste:","paste-json-text-js")),el(Toggle,{label:__("Post name(Slug)","paste-json-text-js"),help:__(pastePostName?"Paste post name.":"Do not paste post name.","paste-json-text-js"),checked:pastePostName,onChange:function(){setPastePostName(!pastePostName)}}),el(Toggle,{label:__("Custom fields(Meta values)","paste-json-text-js"),help:__(pasteMetaValues?"Paste custom fields.":"Do not paste custom fields.","paste-json-text-js"),checked:pasteMetaValues,onChange:function(){setPasteMetaValues(!pasteMetaValues)}}),el(Button,{label:"paste it",variant:"secondary",onClick:pastePostData},__("Paste to post","paste-json-text-js"))):""))};wp.plugins.registerPlugin("plugin-paste-json-text",{render:function(){return el(wp.editPost.PluginSidebar,{name:"plugin-paste-json-text",icon:"clipboard",title:__("Paste JSON text","paste-json-text-js")},el(PasteJSONForm))}})}(window.wp);